{"version":3,"file":"page.js","sources":["../../src/js/page/utils.js","../../src/js/utils/storage.js","../../src/js/page/worker-messenger.js","../../src/js/page/gzip.js","../../src/js/page/svg-file.js","../../src/js/page/ui/pan-zoom.js","../../src/js/page/ui/svg-output.js","../../src/js/page/ui/code-output.js","../../src/js/page/prism.js","../../src/js/page/ui/output.js","../../src/js/page/ui/ripple.js","../../src/js/page/ui/spinner.js","../../src/js/page/ui/floating-action-button.js","../../src/js/page/ui/download-button.js","../../src/js/page/ui/copy-button.js","../../src/js/page/ui/bg-fill-button.js","../../src/js/page/ui/results.js","../../node_modules/nanoevents/index.js","../../src/js/page/ui/material-slider.js","../../src/js/page/ui/settings.js","../../src/js/page/ui/main-menu.js","../../src/js/page/ui/toasts.js","../../src/js/page/ui/file-drop.js","../../src/js/page/ui/preloader.js","../../src/js/page/ui/changelog.js","../../src/js/page/ui/results-container.js","../../src/js/page/ui/view-toggler.js","../../src/js/page/results-cache.js","../../src/js/page/ui/main-ui.js","../../src/js/page/main-controller.js","../../src/js/page/svgo.js","../../src/js/page/index.js"],"sourcesContent":["export const domReady = new Promise(resolve => {\n  function checkState() {\n    if (document.readyState != 'loading') resolve();\n  }\n  document.addEventListener('readystatechange', checkState);\n  checkState();\n});\n\nconst range = document.createRange();\nrange.selectNode(document.documentElement);\n\nexport function strToEl(str) {\n  const frag = range.createContextualFragment(str);\n  return frag.children[0];\n}\n\nconst entityMap = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  \"/\": '&#x2F;'\n};\n\nexport function escapeHTML(str) {\n  return String(str).replace(/[&<>\"'/]/g, s => entityMap[s]);\n}\n\nexport function escapeHtmlTag(strings, ...values) {\n  values = values.map(s => escapeHTML(s));\n  return strings.reduce((str, val, i) => str += val + (values[i] || ''), '');\n}\n\nexport function readFileAsText(file) {\n  return new Response(file).text();\n}\n\nfunction transitionClassFunc({removeClass = false}={}) {\n  return function(el, className = 'active', transitionClass = 'transition') {\n    if (removeClass) {\n      if (!el.classList.contains(className)) return Promise.resolve();\n    }\n    else {\n      if (el.classList.contains(className)) return Promise.resolve();\n    }\n\n    const transitionEnd = new Promise(resolve => {\n      const listener = event => {\n        if (event.target != el) return;\n        el.removeEventListener('transitionend', listener);\n        el.classList.remove(transitionClass);\n        resolve();\n      };\n\n      el.classList.add(transitionClass);\n\n      requestAnimationFrame(() => {\n        el.addEventListener('transitionend', listener);\n        el.classList[removeClass ? 'remove' : 'add'](className);\n      });\n    });\n\n    const transitionTimeout = new Promise(resolve => setTimeout(resolve, 1000));\n\n    return Promise.race([transitionEnd, transitionTimeout]);\n  };\n}\n\nexport const transitionToClass = transitionClassFunc();\nexport const transitionFromClass = transitionClassFunc({removeClass: true});\n\nexport function trackFocusMethod() {\n  var focusMethod = 'mouse';\n\n  document.body.addEventListener('focus', event => {\n    event.target.classList.add(focusMethod == 'key' ? 'key-focused' : 'mouse-focused');\n  }, true);\n\n  document.body.addEventListener('blur', event => {\n    event.target.classList.remove('key-focused', 'mouse-focused');\n  }, true);\n\n  document.body.addEventListener('keydown', () => {\n    focusMethod = 'key';\n  }, true);\n\n  document.body.addEventListener('mousedown', () => {\n    focusMethod = 'mouse';\n  }, true);\n}\n","export let idbKeyval = (() => {\n  let db;\n\n  function getDB() {\n    if (!db) {\n      db = new Promise((resolve, reject) => {\n        const openreq = indexedDB.open('svgo-keyval', 1);\n\n        openreq.onerror = () => {\n          reject(openreq.error);\n        };\n\n        openreq.onupgradeneeded = () => {\n          // First time setup: create an empty object store\n          openreq.result.createObjectStore('keyval');\n        };\n\n        openreq.onsuccess = () => {\n          resolve(openreq.result);\n        };\n      });\n    }\n    return db;\n  }\n\n  async function withStore(type, callback) {\n    const db = await getDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction('keyval', type);\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n      callback(transaction.objectStore('keyval'));\n    });\n  }\n\n  return {\n    async get(key) {\n      let req;\n      await withStore('readonly', store => {\n        req = store.get(key);\n      });\n      return req.result;\n    },\n    set(key, value) {\n      return withStore('readwrite', store => {\n        store.put(value, key);\n      });\n    },\n    delete(key) {\n      return withStore('readwrite', store => {\n        store.delete(key);\n      });\n    }\n  };\n})();\n\n// iOS add-to-homescreen is missing IDB, or at least it used to.\n// I haven't tested this in a while.\nif (!self.indexedDB) {\n  idbKeyval = {\n    get: key => Promise.resolve(localStorage.getItem(key)),\n    set: (key, val) => Promise.resolve(localStorage.setItem(key, val)),\n    delete: key => Promise.resolve(localStorage.removeItem(key))\n  };\n}\n","export default class WorkerMessenger {\n  constructor(url) {\n    this._requestId = 0;\n    // worker jobs awaiting response { [requestId]: [ resolve, reject ] }\n    this._pending = {};\n    this._url = url;\n    this._worker = null;\n  }\n\n  release() {\n    this._abortPending();\n    if (this._worker) {\n      this._worker.terminate();\n      this._worker = null;\n    }\n  }\n\n  abort() {\n    if (Object.keys(this._pending).length === 0) return;\n\n    this._abortPending();\n    if (this._worker) {\n      this._worker.terminate();\n    }\n    this._startWorker();\n  }\n\n  _abortPending() {\n    for (const key of Object.keys(this._pending)) {\n      this._fulfillPending(key, null, new DOMException(\"AbortError\", \"AbortError\"));\n    }\n  }\n\n  _startWorker() {\n    this._worker = new Worker(this._url);\n    this._worker.onmessage = event => this._onMessage(event);\n  }\n\n  _postMessage(message) {\n    if (!this._worker) {\n      this._startWorker();\n    }\n    this._worker.postMessage(message);\n  }\n\n  _onMessage(event) {\n    if (!event.data.id) {\n      console.log(\"Unexpected message\", event);\n      return;\n    }\n\n    this._fulfillPending(\n      event.data.id,\n      event.data.result,\n      event.data.error && new Error(event.data.error),\n    );\n  }\n\n  _fulfillPending(id, result, error) {\n    const resolver = this._pending[id];\n\n    if (!resolver) {\n      console.log(\"No resolver for\", { id, result, error });\n      return;\n    }\n\n    delete this._pending[id];\n\n    if (error) {\n      resolver[1](error);\n      return;\n    }\n\n    resolver[0](result);\n  }\n\n  _requestResponse(message) {\n    return new Promise((resolve, reject) => {\n      message.id = ++this._requestId;\n      this._pending[message.id] = [resolve, reject];\n      this._postMessage(message);\n    });\n  }\n}\n","import WorkerMessenger from './worker-messenger';\n\nclass Gzip extends WorkerMessenger {\n  constructor() {\n    super('js/gzip-worker.js');\n  }\n\n  compress(svgData) {\n    return this._requestResponse({\n      data: svgData\n    });\n  }\n}\n\nexport const gzip = new Gzip();\n","import { gzip } from './gzip';\n\nexport default class SvgFile {\n  constructor(text, width, height) {\n    this.text = text;\n    this._compressedSize = null;\n    this._url = null;\n    this.width = width;\n    this.height = height;\n  }\n\n  async size({ compress }) {\n    if (!compress) {\n      return this.text.length;\n    }\n\n    if (!this._compressedSize) {\n      this._compressedSize = gzip.compress(this.text).then(r => r.byteLength);\n    }\n\n    return this._compressedSize;\n  }\n\n  get url() {\n    if (!this._url) {\n      this._url = URL.createObjectURL(\n        new Blob([this.text], { type: 'image/svg+xml' })\n      );\n    }\n\n    return this._url;\n  }\n\n  release() {\n    if (!this._url) return;\n\n    URL.revokeObjectURL(this._url);\n  }\n}\n","function getXY(obj) {\n  return {\n    x: obj.pageX,\n    y: obj.pageY\n  };\n}\n\nfunction touchDistance(touch1, touch2) {\n  const dx = Math.abs(touch2.x - touch1.x);\n  const dy = Math.abs(touch2.y - touch1.y);\n  return Math.sqrt(dx*dx + dy*dy);\n}\n\nfunction getMidpoint(point1, point2) {\n  return {\n    x: (point1.x + point2.x) / 2,\n    y: (point1.y + point2.y) / 2\n  };\n}\n\nfunction getPoints(event) {\n  if (event.touches) {\n    return Array.from(event.touches).map(t => getXY(t));\n  }\n  else {\n    return [getXY(event)];\n  }\n}\n\nexport default class PanZoom {\n  constructor(target, {\n    eventArea = target,\n    shouldCaptureFunc = () => true\n  }={}) {\n    this._target = target;\n    this._shouldCaptureFunc = shouldCaptureFunc;\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._active = 0;\n    this._lastPoints = [];\n\n    // bind\n    [\n      '_onPointerDown',\n      '_onPointerMove',\n      '_onPointerUp'\n    ].forEach(funcName => {\n      this[funcName] = this[funcName].bind(this);\n    });\n\n    // bound events\n    eventArea.addEventListener('mousedown', this._onPointerDown);\n    eventArea.addEventListener('touchstart', this._onPointerDown);\n\n    // unbonud\n    eventArea.addEventListener('wheel', e => this._onWheel(e));\n  }\n\n  reset() {\n    this._dx = 0;\n    this._dy = 0;\n    this._scale = 1;\n    this._update();\n  }\n\n  _onWheel(event) {\n    if (!this._shouldCaptureFunc(event.target)) return;\n    event.preventDefault();\n\n    const boundingRect = this._target.getBoundingClientRect();\n    let delta = event.deltaY;\n\n    if (event.deltaMode === 1) { // 1 is \"lines\", 0 is \"pixels\"\n      // Firefox uses \"lines\" when mouse is connected\n      delta *= 15;\n    }\n\n    // stop mouse wheel producing huge values\n    delta = Math.max(Math.min(delta, 60), -60);\n\n    const scaleDiff = (delta / 300) + 1;\n\n    // avoid to-small values\n    if (this._scale * scaleDiff < 0.05) return;\n\n    this._scale *= scaleDiff;\n    this._dx -= (event.pageX - boundingRect.left) * (scaleDiff - 1);\n    this._dy -= (event.pageY - boundingRect.top) * (scaleDiff - 1);\n    this._update();\n  }\n\n  _onFirstPointerDown() {\n    document.addEventListener('mousemove', this._onPointerMove);\n    document.addEventListener('mouseup', this._onPointerUp);\n    document.addEventListener('touchmove', this._onPointerMove);\n    document.addEventListener('touchend', this._onPointerUp);\n  }\n\n  _onPointerDown(event) {\n    if (event.type == 'mousedown' && event.button !== 0) return;\n    if (!this._shouldCaptureFunc(event.target)) return;\n    event.preventDefault();\n\n    this._lastPoints = getPoints(event);\n    this._active++;\n\n    if (this._active === 1) {\n      this._onFirstPointerDown();\n    }\n  }\n\n  _onPointerMove(event) {\n    event.preventDefault();\n    const points = getPoints(event);\n    const averagePoint = points.reduce(getMidpoint);\n    const averageLastPoint = this._lastPoints.reduce(getMidpoint);\n    const boundingRect = this._target.getBoundingClientRect();\n\n    this._dx += averagePoint.x - averageLastPoint.x;\n    this._dy += averagePoint.y - averageLastPoint.y;\n\n    if (points[1]) {\n      const scaleDiff = touchDistance(points[0], points[1]) / touchDistance(this._lastPoints[0], this._lastPoints[1]);\n      this._scale *= scaleDiff;\n      this._dx -= (averagePoint.x - boundingRect.left) * (scaleDiff - 1);\n      this._dy -= (averagePoint.y - boundingRect.top) * (scaleDiff - 1);\n    }\n\n    this._update();\n    this._lastPoints = points;\n  }\n\n  _update() {\n    this._target.style.transform = `translate3d(${this._dx}px, ${this._dy}px, 0) scale(${this._scale})`;\n  }\n\n  _onPointerUp(event) {\n    event.preventDefault();\n    this._active--;\n    this._lastPoints.pop();\n\n    if (this._active) {\n      this._lastPoints = getPoints(event);\n      return;\n    }\n\n    document.removeEventListener('mousemove', this._onPointerMove);\n    document.removeEventListener('mouseup', this._onPointerUp);\n    document.removeEventListener('touchmove', this._onPointerMove);\n    document.removeEventListener('touchend', this._onPointerUp);\n  }\n}\n","import { domReady, strToEl } from '../utils';\nimport PanZoom from './pan-zoom';\n\nexport default class SvgOutput {\n  constructor() {\n    this.container = strToEl(\n      '<div class=\"svg-output\">' +\n        '<div class=\"svg-container\">' +\n          '<iframe class=\"svg-frame\" sandbox=\"allow-scripts\"></iframe>' +\n        '</div>' +\n        // Stop touches going into the iframe.\n        // pointer-events + touch + iframe doesn't work in Chrome :(\n        '<div class=\"svg-clickjacker\"></div>' +\n      '</div>' +\n    '');\n\n\n    this._svgFrame = this.container.querySelector('.svg-frame');\n    this._svgFrame.scrolling = 'no';\n\n    this._svgContainer = this.container.querySelector('.svg-container');\n\n    domReady.then(() => {\n      this._panZoom = new PanZoom(this._svgContainer, {\n        eventArea: this.container\n      });\n    });\n  }\n\n  setSvg(svgFile) {\n    // I would rather use blob urls, but they don't work in Firefox\n    // All the internal refs break.\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1125667\n    const nextLoad = this._nextLoadPromise();\n    this._svgFrame.src = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svgFile.text);\n    this._svgFrame.width = svgFile.width;\n    this._svgFrame.height = svgFile.height;\n    return nextLoad;\n  }\n\n  reset() {\n    this._svgFrame.src = \"about:blank\";\n    this._panZoom.reset();\n  }\n\n  _nextLoadPromise() {\n    return new Promise(resolve => {\n      const onload = () => {\n        this._svgFrame.removeEventListener('load', onload);\n        resolve();\n      };\n      this._svgFrame.addEventListener('load', onload);\n    });\n  }\n}\n","import { strToEl } from '../utils';\nimport Prism from '../prism';\nconst prism = new Prism();\n\nexport default class CodeOutput {\n  constructor() {\n    this.container = strToEl(\n      '<div class=\"code-output\">' +\n        '<pre><code></code></pre>' +\n      '</div>' +\n    '');\n    this._codeEl = this.container.querySelector('code');\n  }\n\n  async setSvg(svgFile) {\n    this._codeEl.innerHTML = await prism.highlight(svgFile.text);\n  }\n\n  reset() {\n    this._codeEl.innerHTML = '';\n  }\n}\n","import WorkerMessenger from './worker-messenger';\n\nexport default class Prism extends WorkerMessenger {\n  constructor() {\n    super('js/prism-worker.js');\n  }\n\n  highlight(svgData) {\n    return this._requestResponse({\n      data: svgData\n    });\n  }\n}\n","import { strToEl, transitionToClass, transitionFromClass } from '../utils';\nimport SvgOutput from './svg-output';\nimport CodeOutput from './code-output';\n\nexport default class Output {\n  constructor() {\n    this.container = strToEl(\n      '<div class=\"output-switcher\"></div>' +\n    '');\n\n    this._types = {\n      image: new SvgOutput(),\n      code: new CodeOutput()\n    };\n\n    this._svgFile = null;\n    this._switchQueue = Promise.resolve();\n    this.set('image', {noAnimate: true});\n  }\n\n  update(svgFile) {\n    this._svgFile = svgFile;\n    return this._types[this._activeType].setSvg(svgFile);\n  }\n\n  reset() {\n    this._types[this._activeType].reset();\n  }\n\n  set(type, {\n    noAnimate = false\n  }={}) {\n    return this._switchQueue = this._switchQueue.then(async () => {\n      const toRemove = this._activeType && this._types[this._activeType].container;\n\n      this._activeType = type;\n      const toAdd = this._types[this._activeType].container;\n      this.container.appendChild(toAdd);\n\n      if (this._svgFile) await this.update(this._svgFile);\n\n      if (noAnimate) {\n        toAdd.classList.add('active');\n        if (toRemove) toRemove.classList.remove('active');\n      }\n      else {\n        const transitions = [\n          transitionToClass(toAdd)\n        ];\n\n        if (toRemove) transitions.push(transitionFromClass(toRemove));\n\n        await Promise.all(transitions);\n      }\n\n      if (toRemove) this.container.removeChild(toRemove);\n    });\n  }\n}\n","import { strToEl } from '../utils';\n\nexport default class Ripple {\n  constructor() {\n    this.container = strToEl('<div class=\"ripple\"></div>');\n  }\n\n  animate() {\n    this.container.classList.remove('animate');\n    this.container.offsetLeft;\n    this.container.classList.add('animate');\n  }\n}\n","import { strToEl } from '../utils';\n\nexport default class Spinner {\n  constructor() {\n    this.container = strToEl(\n      '<div class=\"spinner\">' +\n        '<div class=\"spinner-container\">' +\n          '<div class=\"spinner-layer\">' +\n            '<div class=\"circle-clipper left\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"gap-patch\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n            '<div class=\"circle-clipper right\">' +\n              '<div class=\"circle\"></div>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n      '</div>' +\n    '');\n\n    this._showTimeout = null;\n    this.container.style.display = 'none';\n\n    const animEndListener = event => {\n      if (event.target == this.container) {\n        this.container.style.display = 'none';\n      }\n    };\n\n    this.container.addEventListener('animationend', animEndListener);\n  }\n\n  show(delay = 300) {\n    clearTimeout(this._showTimeout);\n    this.container.style.display = 'none';\n    this.container.classList.remove('cooldown');\n    this._showTimeout = setTimeout(() => {\n      this.container.style.display = '';\n    }, delay);\n  }\n\n  hide() {\n    clearTimeout(this._showTimeout);\n    this.container.classList.add('cooldown');\n  }\n}\n","import { strToEl } from '../utils';\nimport Ripple from './ripple';\nimport Spinner from './spinner';\n\nexport default class FloatingActionButton {\n  constructor({ title, href, iconSvg, classList, minor }) {\n    this.container = strToEl(\n      (href ? '<a>' : '<div role=\"button\" tabindex=\"0\">') +\n        iconSvg +\n      (href ? '</a>' : '</div>') +\n    '');\n\n    if (href) {\n      this.container.href = href;\n    }\n    if (title) {\n      this.container.setAttribute('title', title);\n    }\n    this.container.classList.add(minor ? 'minor-floating-action-button' : 'floating-action-button');\n    if (classList) {\n      classList.forEach((className) => { this.container.classList.add(className); });\n    }\n\n    this._ripple = new Ripple();\n    this.container.appendChild(this._ripple.container);\n\n    this._spinner = new Spinner();\n    this.container.appendChild(this._spinner.container);\n\n    this.container.addEventListener('click', () => this._onClick());\n  }\n\n  _onClick() {\n    this._ripple.animate();\n  }\n\n  working() {\n    this._spinner.show(500);\n  }\n\n  done() {\n    this._spinner.hide();\n  }\n}\n","import FloatingActionButton from './floating-action-button';\n\nexport default class DownloadButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Download';\n\n    super({\n      title,\n      href: './',\n      iconSvg: (\n        '<svg viewBox=\"0 0 24 24\" class=\"icon\">' +\n          `<title>${title}</title>` +\n          '<path d=\"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z\"/>' +\n        '</svg>'\n      )\n    });\n  }\n\n  _onClick(event) {\n    super._onClick(event);\n  }\n\n  setDownload(filename, svgFile) {\n    this.container.download = filename;\n    this.container.href = svgFile.url;\n  }\n}\n","import FloatingActionButton from './floating-action-button';\n\nexport default class CopyButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Copy as text';\n\n    super({\n      title,\n      iconSvg: (\n        '<svg viewBox=\"0 0 24 24\" class=\"icon\">' +\n          `<title>${title}</title>` +\n          '<path d=\"M16 1H4C3 1 2 2 2 3v14h2V3h12V1zm3 4H8C7 5 6 6 6 7v14c0 1 1 2 2 2h11c1 0 2-1 2-2V7c0-1-1-2-2-2zm0 16H8V7h11v14z\"/>' +\n        '</svg>'\n      ),\n      minor: true\n    });\n\n    this._text = null;\n    this._pre = document.createElement('pre');\n  }\n\n  _onClick(event) {\n    super._onClick(event);\n    this.copyText();\n  }\n\n  copyText() {\n    if (!this._text) return false;\n  \n    this._pre.textContent = this._text;\n    document.body.appendChild(this._pre);\n    getSelection().removeAllRanges();\n\n    const range = document.createRange();\n    range.selectNode(this._pre);\n\n    window.getSelection().addRange(range);\n\n    document.execCommand('copy');\n    getSelection().removeAllRanges();\n    document.body.removeChild(this._pre);\n    \n    return true;\n  }\n  setCopyText(text) {\n    this._text = text;\n  }\n  \n\n}\n","import FloatingActionButton from './floating-action-button';\n\nexport default class BgFillButton extends FloatingActionButton {\n  constructor() {\n    const title = 'Preview on vivid background';\n\n    super({\n      title,\n      iconSvg: (\n        '<svg viewBox=\"0 0 24 24\" class=\"icon\">' +\n          `<title>${title}</title>` +\n          '<path d=\"M21.143 9.667c-.733-1.392-1.914-3.05-3.617-4.753C14.549 1.936 12.048 1 10.741 1c-.414 0-.708.094-.86.246L8.52 2.606c-1.899-.236-3.42.106-4.294.983-.876.875-1.164 2.159-.792 3.523.492 1.806 2.305 4.049 5.905 5.375.038.323.157.638.405.885.588.588 1.535.586 2.121 0s.588-1.533.002-2.119a1.5 1.5 0 0 0-2.123-.001l-.17.256c-2.031-.765-3.395-1.828-4.232-2.9l3.879-3.875c.496 2.73 6.432 8.676 9.178 9.178l-7.115 7.107c-.234.153-2.798-.316-6.156-3.675-3.393-3.393-3.175-5.271-3.027-5.498L3.96 9.989C3.521 9.63 3.035 8.886 2.819 8.3L.685 10.431C.24 10.877 0 11.495 0 12.251c0 1.634 1.121 3.915 3.713 6.506C6.477 21.521 9.293 23 11.145 23c.648 0 1.18-.195 1.547-.562l8.086-8.078c.91.874-.778 3.538-.778 4.648a2 2 0 0 0 4-.001c0-3.184-1.425-6.81-2.857-9.34zM4.934 4.296c.527-.53 1.471-.791 2.656-.761L4.381 6.741c-.236-.978-.049-1.845.553-2.445zm9.292 4.079-.03-.029C12.904 7.054 10.393 3.99 11.1 3.283c.715-.715 3.488 1.521 5.062 3.096.862.862 2.088 2.247 2.937 3.458-1.717-1.074-3.491-1.469-4.873-1.462z\"/>' +\n        '</svg>'\n      ),\n      classList: [ 'fillAB' ],\n      minor: true\n    });\n  }\n\n  _onClick(event) {\n    super._onClick(event);\n    // event adds a background color\n    if (this.container.classList.contains('active')) {\n      this.container.classList.remove('active');\n      this.setColor('transparent');\n    }\n    else {\n      this.container.classList.add('active');\n      this.setColor('rgba(0, 0, 0, 0.7)');\n    }\n  }\n\n  setColor(color) {\n    document.documentElement.style.backgroundColor = color;\n  }\n}\n","import { strToEl } from '../utils';\n\nfunction round(num, places) {\n  const mult = Math.pow(10, places);\n  return Math.floor(Math.round(num * mult)) / mult;\n}\n\nfunction humanSize(bytes) {\n  if (bytes < 1024) {\n    return bytes + ' bytes';\n  }\n  else {\n    return round(bytes / 1024, 2) + 'k';\n  }\n}\n\nexport default class Results {\n  constructor() {\n    this.container = strToEl(\n      '<div class=\"results\">' +\n        '<span class=\"size\"></span> ' +\n        '<span class=\"diff\"></span>' +\n      '</div>' +\n    '');\n\n    this._sizeEl = this.container.querySelector('.size');\n    this._newSizeEl = this.container.querySelector('.newSize');\n    this._diffEl = this.container.querySelector('.diff');\n  }\n\n  update({ size, comparisonSize }) {\n    if (comparisonSize) {\n      this._sizeEl.textContent = humanSize(comparisonSize) + ' → ' + humanSize(size);\n    } else {\n      this._sizeEl.textContent = humanSize(size);\n    }\n\n    this._diffEl.classList.remove('decrease', 'increase');\n\n    // just displaying a single size?\n    if (!comparisonSize) {\n      this._diffEl.textContent = '';\n      return;\n    }\n    else if (size === comparisonSize) {\n      this._diffEl.textContent = '100%';\n    }\n    else {\n      this._diffEl.textContent = round(size / comparisonSize * 100, 2) + '%';\n      this._diffEl.classList.add(size > comparisonSize ? 'increase' : 'decrease');\n    }\n  }\n}\n","export let createNanoEvents = () => ({\n  events: {},\n  emit(event, ...args) {\n    ;(this.events[event] || []).forEach(i => i(...args))\n  },\n  on(event, cb) {\n    ;(this.events[event] = this.events[event] || []).push(cb)\n    return () =>\n      (this.events[event] = (this.events[event] || []).filter(i => i !== cb))\n  }\n})\n","import { strToEl } from '../utils';\n\nexport default class MaterialSlider {\n  constructor(rangeEl) {\n    this.container = strToEl(`\n      <div class=\"material-slider\">\n        <div class=\"track\">\n          <div class=\"track-on\"></div>\n          <div class=\"handle\">\n            <div class=\"arrow\"></div>\n            <div class=\"val\"></div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    this.range = rangeEl;\n    this._handle = this.container.querySelector('.handle');\n    this._trackOn = this.container.querySelector('.track-on');\n    this._val = this.container.querySelector('.val');\n\n    rangeEl.parentNode.insertBefore(this.container, rangeEl);\n    this.container.insertBefore(rangeEl, this.container.firstChild);\n\n    rangeEl.addEventListener('input', () => this._onInputChange());\n    this.range.addEventListener('mousedown', () => this._onRangeMouseDown());\n    this.range.addEventListener('touchstart', () => this._onRangeTouchStart());\n    this.range.addEventListener('touchend', () => this._onRangeTouchEnd());\n\n    this._setPosition();\n  }\n\n  _onRangeTouchStart() {\n    this.range.focus();\n  }\n\n  _onRangeTouchEnd() {\n    this.range.blur();\n  }\n\n  _onRangeMouseDown() {\n    this.range.classList.add('active');\n\n    const upListener = () => {\n      requestAnimationFrame(() => {\n        this.range.blur();\n      });\n      this.range.classList.remove('active');\n      document.removeEventListener('mouseup', upListener);\n    };\n    document.addEventListener('mouseup', upListener);\n  }\n\n  set value(newVal) {\n    this.range.value = newVal;\n    this._update();\n  }\n\n  _onInputChange() {\n    this._update();\n  }\n\n  _update() {\n    requestAnimationFrame(() => this._setPosition());\n  }\n\n  _setPosition() {\n    const { min, max, value } = this.range;\n    const percent = (Number(value) - min) / (max - min);\n\n    this._trackOn.style.width =\n      this._handle.style.left = percent * 100 + \"%\";\n\n    this._val.textContent = value;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\n\nimport { domReady } from '../utils';\nimport MaterialSlider from './material-slider';\nimport Ripple from './ripple';\n\nexport default class Settings {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this._throttleTimeout = null;\n\n    domReady.then(() => {\n      this._pluginInputs = Array.from(\n        document.querySelectorAll('.settings .plugins input')\n      );\n      this._globalInputs = Array.from(\n        document.querySelectorAll('.settings .global input')\n      );\n\n      this._resetRipple = new Ripple();\n      this._resetBtn = document.querySelector('.setting-reset');\n      this._resetBtn.appendChild(this._resetRipple.container);\n\n      // map real range elements to Slider instances\n      this._sliderMap = new WeakMap();\n\n      // enhance ranges\n      Array.from(\n        document.querySelectorAll('.settings input[type=range]')\n      ).forEach(el => this._sliderMap.set(el, new MaterialSlider(el)));\n\n      this.container = document.querySelector('.settings');\n      this._scroller = document.querySelector('.settings-scroller');\n\n      this.container.addEventListener('input', e => this._onChange(e));\n      this._scroller.addEventListener('wheel', e => this._onMouseWheel(e));\n      this._resetBtn.addEventListener('click', e => this._onReset(e));\n\n      // Stop double-tap text selection.\n      // This stops all text selection which is kinda sad.\n      // I think this code will bite me.\n      this._scroller.addEventListener('mousedown', e => {\n        if (e.target.closest('input[type=range]')) return;\n        e.preventDefault();\n      });\n    });\n  }\n\n  _onMouseWheel(event) {\n    // Prevents bounce effect on desktop.\n    // Firefox uses DELTA_LINE on a mouse wheel, ignore it\n    if (!event.deltaMode) { // 0 is \"pixels\"\n      event.preventDefault();\n      event.currentTarget.scrollTop += event.deltaY;\n    }\n  }\n\n  _onChange(event) {\n    clearTimeout(this._throttleTimeout);\n\n    // throttle range\n    if (event.target.type == 'range') {\n      this._throttleTimeout = setTimeout(() => this.emitter.emit('change'), 150);\n    }\n    else {\n      this.emitter.emit('change');\n    }\n  }\n\n  _onReset() {\n    this._resetRipple.animate();\n    const oldSettings = this.getSettings();\n    // Set all inputs according to their initial attributes\n    for (const inputEl of this._globalInputs) {\n      if (inputEl.type == 'checkbox') {\n        inputEl.checked = inputEl.hasAttribute('checked');\n      }\n      else if (inputEl.type == 'range') {\n        this._sliderMap.get(inputEl).value = inputEl.getAttribute('value');\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      inputEl.checked = inputEl.hasAttribute('checked');\n    }\n\n    this.emitter.emit('reset', oldSettings);\n    this.emitter.emit('change');\n  }\n\n  setSettings(settings) {\n    for (const inputEl of this._globalInputs) {\n      if (!(inputEl.name in settings)) continue;\n\n      if (inputEl.type == 'checkbox') {\n        inputEl.checked = settings[inputEl.name];\n      }\n      else if (inputEl.type == 'range') {\n        this._sliderMap.get(inputEl).value = settings[inputEl.name];\n      }\n    }\n\n    for (const inputEl of this._pluginInputs) {\n      if (!(inputEl.name in settings.plugins)) continue;\n      inputEl.checked = settings.plugins[inputEl.name];\n    }\n  }\n\n  getSettings() {\n    // fingerprint is used for cache lookups\n    const fingerprint = [];\n\n    const output = {\n      plugins: {}\n    };\n\n    this._globalInputs.forEach(inputEl => {\n      if (inputEl.name != 'gzip' && inputEl.name != 'original') {\n        if (inputEl.type == 'checkbox') {\n          fingerprint.push(Number(inputEl.checked));\n        }\n        else {\n          fingerprint.push('|' + inputEl.value + '|');\n        }\n      }\n\n      if (inputEl.type == 'checkbox') {\n        output[inputEl.name] = inputEl.checked;\n      }\n      else {\n        output[inputEl.name] = inputEl.value;\n      }\n    });\n\n    this._pluginInputs.forEach(inputEl => {\n      fingerprint.push(Number(inputEl.checked));\n      output.plugins[inputEl.name] = inputEl.checked;\n    });\n\n    output.fingerprint = fingerprint.join();\n\n    return output;\n  }\n}\n","import {\n  domReady,\n  transitionFromClass,\n  transitionToClass,\n  readFileAsText\n} from '../utils';\nimport Spinner from './spinner';\nimport { createNanoEvents } from 'nanoevents';\n\nexport default class MainMenu {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.allowHide = false;\n    this._spinner = new Spinner();\n\n    domReady.then(() => {\n      this.container = document.querySelector('.main-menu');\n      this._loadFileInput = document.querySelector('.load-file-input');\n      this._pasteInput = document.querySelector('.paste-input');\n      this._loadDemoBtn = document.querySelector('.load-demo');\n      this._loadFileBtn = document.querySelector('.load-file');\n      this._pasteLabel = document.querySelector('.menu-input');\n      this._overlay = this.container.querySelector('.overlay');\n      this._menu = this.container.querySelector('.menu');\n\n      document.querySelector('.menu-btn')\n        .addEventListener('click', e => this._onMenuButtonClick(e));\n\n      this._overlay.addEventListener('click', e => this._onOverlayClick(e));\n\n      this._loadFileBtn.addEventListener('click', e => this._onLoadFileClick(e));\n      this._loadDemoBtn.addEventListener('click', e => this._onLoadDemoClick(e));\n      this._loadFileInput.addEventListener('change', () => this._onFileInputChange());\n      this._pasteInput.addEventListener('input', () => this._onTextInputChange());\n    });\n  }\n\n  show() {\n    this.container.classList.remove('hidden');\n    transitionFromClass(this._overlay, 'hidden');\n    transitionFromClass(this._menu, 'hidden');\n  }\n\n  hide() {\n    if (!this.allowHide) return;\n    this.stopSpinner();\n    this.container.classList.add('hidden');\n    transitionToClass(this._overlay, 'hidden');\n    transitionToClass(this._menu, 'hidden');\n  }\n\n  stopSpinner() {\n    this._spinner.hide();\n  }\n\n  showFilePicker() {\n    this._loadFileInput.click();\n  }\n\n  setPasteInput(value) {\n    this._pasteInput.value = value;\n    this._pasteInput.dispatchEvent(new Event('input'));\n  }\n\n  _onOverlayClick(event) {\n    event.preventDefault();\n    this.hide();\n  }\n\n  _onMenuButtonClick(event) {\n    event.preventDefault();\n    this.show();\n  }\n\n  _onTextInputChange() {\n    const val = this._pasteInput.value.trim();\n\n    if (val.includes('</svg>')) {\n      this._pasteInput.value = '';\n      this._pasteInput.blur();\n\n      this._pasteLabel.appendChild(this._spinner.container);\n      this._spinner.show();\n\n      this.emitter.emit('svgDataLoad', {\n        data: val,\n        filename: 'image.svg'\n      });\n    }\n  }\n\n  _onLoadFileClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this.showFilePicker();\n  }\n\n  async _onFileInputChange() {\n    const file = this._loadFileInput.files[0];\n\n    if (!file) return;\n\n    this._loadFileBtn.appendChild(this._spinner.container);\n    this._spinner.show();\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name\n    });\n  }\n\n  async _onLoadDemoClick(event) {\n    event.preventDefault();\n    event.target.blur();\n    this._loadDemoBtn.appendChild(this._spinner.container);\n    this._spinner.show();\n\n    try {\n      this.emitter.emit('svgDataLoad', {\n        data: await fetch('test-svgs/car-lite.svg').then(r => r.text()),\n        filename: 'car-lite.svg'\n      });\n    }\n    catch (err) {\n      this.stopSpinner();\n\n      const error = 'serviceWorker' in navigator && navigator.serviceWorker.controller ?\n        Error(\"Demo not available offline\") :\n        Error(\"Couldn't fetch demo SVG\");\n\n      this.emitter.emit('error', { error });\n    }\n  }\n}\n","import { strToEl, transitionToClass } from '../utils';\n\nclass Toast {\n  constructor(message, duration, buttons) {\n    this.container = strToEl(\n      '<div class=\"toast\"><div class=\"toast-content\"></div></div>' +\n    '');\n\n    this._content = this.container.querySelector('.toast-content');\n    this._content.textContent = message;\n    this._answerResolve;\n    this._hideTimeout;\n\n    this.answer = new Promise(r => this._answerResolve = r);\n\n    buttons.forEach(button => {\n      var buttonEl = document.createElement('button');\n      buttonEl.className = 'unbutton';\n      buttonEl.textContent = button;\n      buttonEl.addEventListener('click', () => {\n        this._answerResolve(button);\n      });\n      this.container.appendChild(buttonEl);\n    });\n\n    if (duration) {\n      this._hideTimeout = setTimeout(() => this.hide(), duration);\n    }\n  }\n\n  hide() {\n    clearTimeout(this._hideTimeout);\n    this._answerResolve();\n    return transitionToClass(this.container, 'hide');\n  }\n}\n\nexport default class Toasts {\n  constructor() {\n    this.container = strToEl(\"<div class='toasts'></div>\");\n  }\n\n  show(message, {\n    duration = 0,\n    buttons = ['dismiss']\n  }={}) {\n    const toast = new Toast(message, duration, buttons);\n    this.container.appendChild(toast.container);\n\n    toast.answer.then(() => toast.hide()).then(() => {\n      this.container.removeChild(toast.container);\n    });\n\n    return toast;\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport {\n  strToEl,\n  domReady,\n  transitionToClass,\n  transitionFromClass,\n  readFileAsText\n} from '../utils';\n\nexport default class FileDrop {\n  constructor() {\n    this.emitter = createNanoEvents();\n    this.container = strToEl(\n      '<div class=\"drop-overlay\">Drop it!</div>' +\n    '');\n\n    // drag events are horrid\n    this._activeEnters = 0;\n    this._currentEnteredElement = null;\n\n    domReady.then(() => {\n      document.addEventListener('dragover', event => event.preventDefault());\n      document.addEventListener('dragenter', event => this._onDragEnter(event));\n      document.addEventListener('dragleave', () => this._onDragLeave());\n      document.addEventListener('drop', event => this._onDrop(event));\n    });\n  }\n\n  _onDragEnter(event) {\n    // firefox double-fires on window enter, this works around it\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1124645\n    if (this._currentEnteredElement == event.target) return;\n    this._currentEnteredElement = event.target;\n\n    if (!this._activeEnters++) {\n      transitionToClass(this.container);\n    }\n  }\n\n  _onDragLeave() {\n    this._currentEnteredElement = null;\n\n    if (!--this._activeEnters) {\n      transitionFromClass(this.container);\n    }\n  }\n\n  async _onDrop(event) {\n    event.preventDefault();\n\n    this._activeEnters = 0;\n    transitionFromClass(this.container);\n\n    const file = event.dataTransfer.files[0];\n    if (!file) return;\n\n    this.emitter.emit('svgDataLoad', {\n      data: await readFileAsText(file),\n      filename: file.name\n    });\n  }\n}\n","import { domReady, transitionFromClass } from '../utils';\n\nexport default class Preloader {\n  constructor() {\n    domReady.then(() => {\n      this.container = document.querySelector('.preloader');\n      this.activated = this.container.classList.contains('active');\n      this.hide();\n    });\n  }\n\n  async hide() {\n    await transitionFromClass(this.container, 'active');\n    this.container.style.display = 'none';\n  }\n}\n","import { strToEl, escapeHtmlTag, transitionToClass, domReady } from '../utils';\n\nexport default class Changelog {\n  constructor(loadedVersion) {\n    this.container = strToEl('<section class=\"changelog\"></section>');\n    this._loadedVersion = loadedVersion;\n  }\n\n  async showLogFrom(lastLoadedVersion) {\n    if (lastLoadedVersion == this._loadedVersion) return;\n    const changelog = await fetch('changelog.json').then(r => r.json());\n    let startIndex = 0;\n    let endIndex = 0;\n\n    for (var i = 0; i < changelog.length; i++) {\n      const entry = changelog[i];\n\n      if (entry.version === this._loadedVersion) {\n        startIndex = i;\n      }\n      else if (entry.version === lastLoadedVersion) {\n        break;\n      }\n      endIndex = i + 1;\n    }\n\n    const changeLis = changelog.slice(startIndex, endIndex)\n      .reduce((arr, entry) => arr.concat(entry.changes), [])\n      .map(change => escapeHtmlTag`<li>${change}</li>`);\n\n    this.container.appendChild(strToEl('<h1>Updated!</h1>'));\n    this.container.appendChild(strToEl(\n      '<ul>' +\n        changeLis.join('') +\n      '</ul>' +\n    ''));\n\n    await domReady;\n    transitionToClass(this.container);\n  }\n}\n","import { domReady } from '../utils';\n\nexport default class ResultsContainer {\n  constructor(results) {\n    this._results = results;\n\n    domReady.then(() => {\n      this._mobileContainer = document.querySelector('.results-container-mobile');\n      this._container = document.querySelector('.results-container');\n      this._query = matchMedia('(min-width: 640px)');\n\n      this._query.addListener(() => this._positionResults());\n      this._positionResults();\n    });\n  }\n\n  _positionResults() {\n    if (this._query.matches) {\n      this._container.appendChild(this._results.container);\n    }\n    else {\n      this._mobileContainer.appendChild(this._results.container);\n    }\n  }\n}\n","import { createNanoEvents } from 'nanoevents';\nimport { domReady } from '../utils';\n\n/**\n * Tabs that toggle between showing the SVG image and XML markup.\n */\nexport default class ViewToggler {\n  constructor() {\n    this.emitter = createNanoEvents();\n    /** @type {HTMLFormElement | null} */\n    this.container = null;\n\n    domReady.then(() => {\n      this.container = document.querySelector('.view-toggler');\n\n      // stop browsers remembering previous form state\n      this.container.output[0].checked = true;\n\n      this.container.addEventListener('change', () => this._onChange());\n    });\n  }\n\n  _onChange() {\n    this.emitter.emit('change', {\n      value: this.container.output.value\n    });\n  }\n}\n","export default class ResultsCache {\n  constructor(size) {\n    this._size = size;\n    this.purge();\n  }\n\n  purge() {\n    this._fingerprints = [];\n    this._items = [];\n    this._index = 0;\n  }\n\n  add(fingerprint, svgFile) {\n    const oldItem = this._items[this._index];\n\n    if (oldItem) {\n      // gc blob url\n      oldItem.release();\n    }\n\n    this._fingerprints[this._index] = fingerprint;\n    this._items[this._index] = svgFile;\n\n    this._index = (this._index + 1) % this._size;\n  }\n\n  match(fingerprint) {\n    return this._items[this._fingerprints.indexOf(fingerprint)];\n  }\n}\n","import { transitionToClass } from '../utils';\n\nexport default class MainUi {\n  constructor(...elements) {\n    this._activated = false;\n    this._toActivate = elements;\n  }\n\n  activate() {\n    if (this._activated) return;\n    this._activated = true;\n\n    return Promise.all(\n      this._toActivate.map(el => transitionToClass(el))\n    );\n  }\n}\n","import { idbKeyval as storage } from '../utils/storage';\nimport Svgo from './svgo';\nimport { domReady } from './utils';\nimport Output from './ui/output';\nimport DownloadButton from './ui/download-button';\nimport CopyButton from './ui/copy-button';\nimport BgFillButton from './ui/bg-fill-button';\nimport Results from './ui/results';\nimport Settings from './ui/settings';\nimport MainMenu from './ui/main-menu';\nimport Toasts from './ui/toasts';\nimport FileDrop from './ui/file-drop';\nimport Preloader from './ui/preloader';\nimport Changelog from './ui/changelog';\nimport ResultsContainer from './ui/results-container';\nimport ViewToggler from './ui/view-toggler';\nimport ResultsCache from './results-cache';\nimport MainUi from './ui/main-ui';\n\nconst svgo = new Svgo();\n\nexport default class MainController {\n  constructor() {\n    this._container = null;\n\n    // ui components\n    this._mainUi = null;\n    this._outputUi = new Output();\n    this._downloadButtonUi = new DownloadButton();\n    this._copyButtonUi = new CopyButton();\n    this._bgFillUi = new BgFillButton();\n    this._resultsUi = new Results();\n    this._settingsUi = new Settings();\n    this._mainMenuUi = new MainMenu();\n    this._toastsUi = new Toasts();\n    this._dropUi = new FileDrop();\n    this._preloaderUi = new Preloader();\n    this._changelogUi = new Changelog(self.version);\n    this._resultsContainerUi = new ResultsContainer(this._resultsUi);\n    this._viewTogglerUi = new ViewToggler();\n\n    // ui events\n    this._settingsUi.emitter.on('change', () => this._onSettingsChange());\n    this._settingsUi.emitter.on('reset', oldSettings => this._onSettingsReset(oldSettings));\n    this._mainMenuUi.emitter.on('svgDataLoad', e => this._onInputChange(e));\n    this._dropUi.emitter.on('svgDataLoad', e => this._onInputChange(e));\n    this._mainMenuUi.emitter.on('error', ({error}) => this._handleError(error));\n    this._viewTogglerUi.emitter.on('change', e => this._onViewSelectionChange(e));\n    window.addEventListener('keydown', e => this._onGlobalKeyDown(e));\n    window.addEventListener('paste', e => this._onGlobalPaste(e));\n    window.addEventListener('copy', e => this._onGlobalCopy(e));\n\n    // state\n    this._inputItem = null;\n    this._cache = new ResultsCache(10);\n    this._latestCompressJobId = 0;\n    this._userHasInteracted = false;\n    this._reloading = false;\n\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.register('sw.js', {\n        scope: './'\n      }).then(registration => {\n        registration.addEventListener('updatefound', () => this._onUpdateFound(registration));\n      });\n    }\n\n    // tell the user about the latest update\n    storage.get('last-seen-version').then(lastSeenVersion => {\n      if (lastSeenVersion) {\n        this._changelogUi.showLogFrom(lastSeenVersion);\n      }\n      storage.set('last-seen-version', self.version);\n    });\n\n    domReady.then(() => {\n      this._container = document.querySelector('.app-output');\n\n      // elements for intro anim\n      this._mainUi = new MainUi(\n        document.querySelector('.toolbar'),\n        document.querySelector('.action-button-container'),\n        this._outputUi.container,\n        this._settingsUi.container\n      );\n\n      const actionContainer = document.querySelector('.action-button-container');\n      const minorActionContainer = document.querySelector('.minor-action-container');\n\n      minorActionContainer.appendChild(this._bgFillUi.container);\n\n      minorActionContainer.appendChild(this._copyButtonUi.container);\n      \n      actionContainer.appendChild(this._downloadButtonUi.container);\n\n      document.querySelector('.output').appendChild(this._outputUi.container);\n      this._container.appendChild(this._toastsUi.container);\n      this._container.appendChild(this._dropUi.container);\n      document.querySelector('.menu-extra').appendChild(this._changelogUi.container);\n\n      // load previous settings\n      this._loadSettings();\n\n      // someone managed to hit the preloader, aww\n      if (this._preloaderUi.activated) {\n        this._toastsUi.show(\"Ready now!\", {\n          duration: 3000\n        });\n      }\n\n      // for testing\n      // eslint-disable-next-line no-constant-condition\n      if (false) {\n        (async () => {\n          this._onInputChange({\n            data: await fetch('test-svgs/car-lite.svg').then(r => r.text()),\n            filename: 'car-lite.svg'\n          });\n        })();\n      }\n    });\n  }\n\n  _onGlobalKeyDown(event) {\n    if (event.key === 'o' && (event.ctrlKey || event.metaKey)) {\n      event.preventDefault();\n      this._mainMenuUi.showFilePicker();\n    }\n\n    if (event.key === 'Escape') {\n      this._mainMenuUi.hide();\n    }\n  }\n\n  _onGlobalPaste(event) {\n    const val = event.clipboardData.getData('text').trim();    \n    if (!val.includes(\"</svg>\")) {\n      this._toastsUi.show(\"Pasted value not an SVG\", {\n        duration: 2000\n      });\n    }\n    else {\n      this._mainMenuUi.setPasteInput(val);\n      event.preventDefault();\n    }\n  }\n\n  _onGlobalCopy(event) {\n    const selection = window.getSelection();\n    if (!selection.isCollapsed) return;\n\n    if (this._copyButtonUi.copyText()) {\n      this._toastsUi.show(\"Copy successful\", {\n        duration: 2000\n      });\n    }\n    else {\n      this._toastsUi.show(\"Nothing to copy\", {\n        duration: 2000\n      });\n    }\n    event.preventDefault();\n  }\n\n  _onViewSelectionChange(event) {\n    this._outputUi.set(event.value);\n  }\n\n  _onUpdateFound(registration) {\n    const newWorker = registration.installing;\n\n    registration.installing.addEventListener('statechange', async () => {\n      if (this._reloading) return;\n\n      // the very first activation!\n      // tell the user stuff works offline\n      if (newWorker.state == 'activated' && !navigator.serviceWorker.controller) {\n        this._toastsUi.show(\"Ready to work offline\", {\n          duration: 5000\n        });\n        return;\n      }\n\n      if (newWorker.state == 'activated' && navigator.serviceWorker.controller) {\n        // if the user hasn't interacted yet, do a sneaky reload\n        if (!this._userHasInteracted) {\n          this._reloading = true;\n          location.reload();\n          return;\n        }\n\n        // otherwise, show the user an alert\n        const toast = this._toastsUi.show(\"Update available\", {\n          buttons: ['reload', 'dismiss']\n        });\n\n        const answer = await toast.answer;\n\n        if (answer == 'reload') {\n          this._reloading = true;\n          location.reload();\n        }\n      }\n    });\n  }\n\n  _onSettingsChange() {\n    const settings = this._settingsUi.getSettings();\n    this._saveSettings(settings);\n    this._compressSvg(settings);\n  }\n\n  async _onSettingsReset(oldSettings) {\n    const toast = this._toastsUi.show(\"Settings reset\", {\n      buttons: ['undo', 'dismiss'],\n      duration: 5000\n    });\n\n    if ((await toast.answer) === 'undo') {\n      this._settingsUi.setSettings(oldSettings);\n      this._onSettingsChange();\n    }\n  }\n\n  async _onInputChange(event) {\n    const settings = this._settingsUi.getSettings();\n    this._userHasInteracted = true;\n\n    try {\n      this._inputItem = await svgo.wrapOriginal(event.data);\n      this._inputFilename = event.filename;\n    }\n    catch(e) {\n      const error = new Error(\"Load failed: \" + e.message);\n      this._mainMenuUi.stopSpinner();\n      this._handleError(error);\n      return;\n    }\n\n    this._cache.purge();\n\n    this._compressSvg(settings);\n    this._outputUi.reset();\n    this._mainUi.activate();\n    this._mainMenuUi.allowHide = true;\n    this._mainMenuUi.hide();\n  }\n\n  _handleError(e) {\n    this._toastsUi.show(e.message);\n    console.error(e);\n  }\n\n  async _loadSettings() {\n    const settings = await storage.get('settings');\n    if (settings) this._settingsUi.setSettings(settings);\n  }\n\n  _saveSettings(settings) {\n    const copy = Object.assign({}, settings);\n    // doesn't make sense to retain the \"show original\" option\n    delete copy.original;\n    storage.set('settings', copy);\n  }\n\n  async _compressSvg(settings) {\n    const thisJobId = this._latestCompressJobId = Math.random();\n\n    await svgo.abort();\n\n    if (thisJobId != this._latestCompressJobId) {\n      // while we've been waiting, there's been a newer call\n      // to _compressSvg, we don't need to do anything\n      return;\n    }\n\n    if (settings.original) {\n      this._updateForFile(this._inputItem, {\n        compress: settings.gzip\n      });\n      return;\n    }\n\n    const cacheMatch = this._cache.match(settings.fingerprint);\n\n    if (cacheMatch) {\n      this._updateForFile(cacheMatch, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip\n      });\n      return;\n    }\n\n    this._downloadButtonUi.working();\n\n    try {\n      const finalResultFile = await svgo.process(this._inputItem.text, settings);\n\n      this._updateForFile(finalResultFile, {\n        compareToFile: this._inputItem,\n        compress: settings.gzip\n      });\n\n      this._cache.add(settings.fingerprint, finalResultFile);\n    }\n    catch (e) {\n      if (e.name === \"AbortError\") return;\n      e.message = \"Minifying error: \" + e.message;\n      this._handleError(e);\n    }\n    finally {\n      this._downloadButtonUi.done();\n    }\n  }\n\n  async _updateForFile(svgFile, { compareToFile, compress }) {\n    this._outputUi.update(svgFile);\n    this._downloadButtonUi.setDownload(this._inputFilename, svgFile);\n    this._copyButtonUi.setCopyText(svgFile.text);\n\n    this._resultsUi.update({\n      comparisonSize: compareToFile && (await compareToFile.size({ compress })),\n      size: await svgFile.size({ compress })\n    });\n  }\n}\n\n","import WorkerMessenger from './worker-messenger';\nimport SvgFile from './svg-file';\n\nexport default class Svgo extends WorkerMessenger {\n  constructor() {\n    super('js/svgo-worker.js');\n    this._currentJob = Promise.resolve();\n  }\n\n  async wrapOriginal(svgText) {\n    const {width, height} = await this._requestResponse({\n      action: 'wrapOriginal',\n      data: svgText\n    });\n\n    return new SvgFile(svgText, width, height);\n  }\n\n  process(svgText, settings) {\n    this.abort();\n\n    return this._currentJob = this._currentJob.catch(() => {}).then(async () => {\n      const result = await this._requestResponse({\n        action: 'process',\n        settings,\n        data: svgText,\n      });\n\n      // return final result\n      return new SvgFile(result.data, result.dimensions.width, result.dimensions.height);\n    });\n  }\n}\n","import { trackFocusMethod } from './utils';\nimport MainController from './main-controller';\n\ntrackFocusMethod();\nnew MainController();\n"],"names":["domReady","Promise","resolve","checkState","document","readyState","addEventListener","range","createRange","strToEl","str","createContextualFragment","children","selectNode","documentElement","entityMap","escapeHtmlTag","strings","values","map","s","String","replace","reduce","val","i","readFileAsText","file","Response","text","transitionClassFunc","removeClass","el","className","transitionClass","classList","contains","transitionEnd","listener","event","target","removeEventListener","remove","add","requestAnimationFrame","transitionTimeout","setTimeout","race","transitionToClass","transitionFromClass","idbKeyval","db","getDB","reject","openreq","indexedDB","open","onerror","error","onupgradeneeded","result","createObjectStore","onsuccess","async","withStore","type","callback","transaction","oncomplete","objectStore","get","key","req","store","set","value","put","delete","self","localStorage","getItem","setItem","removeItem","WorkerMessenger","constructor","url","this","_requestId","_pending","_url","_worker","release","_abortPending","terminate","abort","Object","keys","length","_startWorker","_fulfillPending","DOMException","Worker","onmessage","_onMessage","_postMessage","message","postMessage","data","id","Error","console","log","resolver","_requestResponse","gzip","super","compress","svgData","SvgFile","width","height","_compressedSize","size","then","r","byteLength","URL","createObjectURL","Blob","revokeObjectURL","getXY","obj","x","pageX","y","pageY","touchDistance","touch1","touch2","dx","Math","abs","dy","sqrt","getMidpoint","point1","point2","getPoints","touches","Array","from","t","PanZoom","eventArea","shouldCaptureFunc","_target","_shouldCaptureFunc","_dx","_dy","_scale","_active","_lastPoints","forEach","funcName","bind","_onPointerDown","e","_onWheel","reset","_update","preventDefault","boundingRect","getBoundingClientRect","delta","deltaY","deltaMode","max","min","scaleDiff","left","top","_onFirstPointerDown","_onPointerMove","_onPointerUp","button","points","averagePoint","averageLastPoint","style","transform","pop","SvgOutput","container","_svgFrame","querySelector","scrolling","_svgContainer","_panZoom","setSvg","svgFile","nextLoad","_nextLoadPromise","src","encodeURIComponent","onload","prism","highlight","CodeOutput","_codeEl","innerHTML","Output","_types","image","code","_svgFile","_switchQueue","noAnimate","update","_activeType","toRemove","toAdd","appendChild","transitions","push","all","removeChild","Ripple","animate","offsetLeft","Spinner","_showTimeout","display","show","delay","clearTimeout","hide","FloatingActionButton","title","href","iconSvg","minor","setAttribute","_ripple","_spinner","_onClick","working","done","DownloadButton","setDownload","filename","download","CopyButton","_text","_pre","createElement","copyText","textContent","body","getSelection","removeAllRanges","window","addRange","execCommand","setCopyText","BgFillButton","setColor","color","backgroundColor","round","num","places","mult","pow","floor","humanSize","bytes","Results","_sizeEl","_newSizeEl","_diffEl","comparisonSize","createNanoEvents","events","emit","args","on","cb","filter","MaterialSlider","rangeEl","_handle","_trackOn","_val","parentNode","insertBefore","firstChild","_onInputChange","_onRangeMouseDown","_onRangeTouchStart","_onRangeTouchEnd","_setPosition","focus","blur","upListener","newVal","percent","Number","Settings","emitter","_throttleTimeout","_pluginInputs","querySelectorAll","_globalInputs","_resetRipple","_resetBtn","_sliderMap","WeakMap","_scroller","_onChange","_onMouseWheel","_onReset","closest","currentTarget","scrollTop","oldSettings","getSettings","inputEl","checked","hasAttribute","getAttribute","setSettings","settings","name","plugins","fingerprint","output","join","MainMenu","allowHide","_loadFileInput","_pasteInput","_loadDemoBtn","_loadFileBtn","_pasteLabel","_overlay","_menu","_onMenuButtonClick","_onOverlayClick","_onLoadFileClick","_onLoadDemoClick","_onFileInputChange","_onTextInputChange","stopSpinner","showFilePicker","click","setPasteInput","dispatchEvent","Event","trim","includes","files","fetch","err","navigator","serviceWorker","controller","Toast","duration","buttons","_content","_answerResolve","_hideTimeout","answer","buttonEl","Toasts","toast","FileDrop","_activeEnters","_currentEnteredElement","_onDragEnter","_onDragLeave","_onDrop","dataTransfer","Preloader","activated","Changelog","loadedVersion","_loadedVersion","showLogFrom","lastLoadedVersion","changelog","json","startIndex","endIndex","entry","version","changeLis","slice","arr","concat","changes","change","ResultsContainer","results","_results","_mobileContainer","_container","_query","matchMedia","addListener","_positionResults","matches","ViewToggler","ResultsCache","_size","purge","_fingerprints","_items","_index","oldItem","match","indexOf","MainUi","elements","_activated","_toActivate","activate","svgo","_currentJob","wrapOriginal","svgText","action","process","catch","dimensions","focusMethod","_mainUi","_outputUi","_downloadButtonUi","_copyButtonUi","_bgFillUi","_resultsUi","_settingsUi","_mainMenuUi","_toastsUi","_dropUi","_preloaderUi","_changelogUi","_resultsContainerUi","_viewTogglerUi","_onSettingsChange","_onSettingsReset","_handleError","_onViewSelectionChange","_onGlobalKeyDown","_onGlobalPaste","_onGlobalCopy","_inputItem","_cache","_latestCompressJobId","_userHasInteracted","_reloading","register","scope","registration","_onUpdateFound","storage","lastSeenVersion","actionContainer","minorActionContainer","_loadSettings","ctrlKey","metaKey","clipboardData","getData","isCollapsed","newWorker","installing","state","location","reload","_saveSettings","_compressSvg","_inputFilename","copy","assign","original","thisJobId","random","_updateForFile","cacheMatch","compareToFile","finalResultFile"],"mappings":"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"}